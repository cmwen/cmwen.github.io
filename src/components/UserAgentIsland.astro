---
const userAgent = Astro.request.headers.get("user-agent") ?? "your device";
const acceptLanguage = Astro.request.headers.get("accept-language") ?? "";
const primaryLocale = acceptLanguage.split(",")[0]?.trim();
// Cache the personalized response briefly to avoid recomputing on every request
Astro.response.headers.set(
  "Cache-Control",
  "public, max-age=0, s-maxage=60, stale-while-revalidate=300"
);
---

<section
  class="user-agent-island mt-6 rounded-lg border border-skin-line bg-skin-card px-4 py-3 text-sm text-skin-base shadow"
  aria-live="polite"
>
  <p
    class="headline mb-1 text-xs font-semibold uppercase tracking-wide text-skin-accent"
  >
    Tailored for you
  </p>
  <p>
    You are browsing from{" "}
    <span class="highlight font-medium text-skin-accent">{userAgent}</span>
    {
      primaryLocale && (
        <>
          {" "}
          with a preferred locale of{" "}
          <span class="highlight font-medium text-skin-accent">
            {primaryLocale}
          </span>
        </>
      )
    }
    .
  </p>
  <p class="note mt-2 text-xs text-skin-base opacity-75">
    This fragment streams after the page shell so the rest of the homepage can
    stay aggressively cached.
  </p>
</section>
