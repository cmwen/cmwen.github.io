---
import Layout from "@layouts/Layout.astro";
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";
import Main from "@layouts/Main.astro";
import ToolCard from "@components/toolbox/ToolCard.astro";
import { TOOLBOX } from "@data/toolbox";
import { SITE } from "@config";
import { defaultLocale, type Locale } from "@i18n/config";
import { messages } from "@i18n/dict";

const lang: Locale = Astro.url.pathname.startsWith("/zh-hant/")
  ? "zh-hant"
  : defaultLocale;
const t = messages[lang];
const title = t.nav.toolbox;
const description =
  lang === "zh-hant"
    ? "我常用工具的精選清單，依分類整理。"
    : "A curated list of tools I use regularly, grouped by category.";
const canonical = new URL(Astro.url.pathname, Astro.site).href;
---

<Layout
  title={`${title} | ${SITE.title}`}
  lang={lang}
  alternates={{
    en: canonical,
    "zh-hant": new URL(`/zh-hant${Astro.url.pathname}`, Astro.site).href,
  }}
>
  <Header activeNav="toolbox" {lang} />
  <Main pageTitle={title} pageDesc={description}>
    <div class="space-y-10">
      {
        TOOLBOX.map(section => (
          <section id={section.id}>
            <h2 class="mb-3 text-2xl font-semibold tracking-wide">
              {t.toolbox.sections[
                section.id as keyof typeof t.toolbox.sections
              ] || section.title}
            </h2>
            <div class="grid gap-4 sm:grid-cols-2">
              {section.tools.map(tool => {
                const isSingleton = section.tools.length === 1;
                const effectiveTool = {
                  ...tool,
                  current: tool.current ?? isSingleton,
                };
                return <ToolCard tool={effectiveTool} />;
              })}
            </div>
          </section>
        ))
      }
    </div>
  </Main>
  <Footer />
</Layout>
