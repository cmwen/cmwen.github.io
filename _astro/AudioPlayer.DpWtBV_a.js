import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r as s}from"./index.Cd_vQiNd.js";const b="audio-playback-speed";function P({slug:u,lang:i="en"}){const n=s.useRef(null),[r,h]=s.useState(!1),[m,p]=s.useState(0),[f,o]=s.useState(0),[c,x]=s.useState(1),[v,g]=s.useState(null),l=i==="zh-hant"?`/podcasts/${u}.zh-hant.mp3`:`/podcasts/${u}.mp3`;s.useEffect(()=>{(async()=>{try{const a=await fetch(l,{method:"HEAD"});g(a.ok)}catch{g(!1)}})()},[l]),s.useEffect(()=>{const e=localStorage.getItem(b);if(e){const a=parseFloat(e);!isNaN(a)&&a>=.25&&a<=2&&x(a)}},[]),s.useEffect(()=>{const e=n.current;if(e){e.playbackRate=c;const a=()=>{e.playbackRate=c};return e.addEventListener("loadedmetadata",a),()=>{e.removeEventListener("loadedmetadata",a)}}},[c]),s.useEffect(()=>{const e=n.current;if(!e)return;const a=()=>{p(e.currentTime)},d=()=>{h(!1)},y=()=>{!isNaN(e.duration)&&isFinite(e.duration)&&o(e.duration)},N=()=>{!isNaN(e.duration)&&isFinite(e.duration)&&o(e.duration)},E=()=>{!isNaN(e.duration)&&isFinite(e.duration)&&o(e.duration)};return e.addEventListener("timeupdate",a),e.addEventListener("loadedmetadata",y),e.addEventListener("durationchange",N),e.addEventListener("canplay",E),e.addEventListener("ended",d),!isNaN(e.duration)&&isFinite(e.duration)&&e.duration>0&&o(e.duration),()=>{e.removeEventListener("timeupdate",a),e.removeEventListener("loadedmetadata",y),e.removeEventListener("durationchange",N),e.removeEventListener("canplay",E),e.removeEventListener("ended",d)}},[l]);const k=()=>{n.current&&(r?n.current.pause():n.current.play(),h(!r))},w=e=>{const a=parseFloat(e.target.value);p(a),n.current&&(n.current.currentTime=a)},S=e=>{const a=parseFloat(e.target.value);x(a),localStorage.setItem(b,a.toString()),n.current&&(n.current.playbackRate=a)},j=e=>{if(isNaN(e))return"0:00";const a=Math.floor(e/60),d=Math.floor(e%60);return`${a}:${d.toString().padStart(2,"0")}`};return v===null||!v?null:t.jsx("div",{className:"mb-6 rounded-lg border border-skin-line bg-skin-card p-4",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("span",{"aria-hidden":!0,className:"text-2xl",children:"üéß"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"m-0 text-base font-semibold text-skin-accent",children:i==="zh-hant"?"Èü≥Ë®äÁâàÊú¨":"Audio Version"}),t.jsx("p",{className:"mt-1 text-xs opacity-70",children:i==="zh-hant"?"Áî± Kokoro TTS ÁîüÊàê":"Generated by Kokoro TTS"}),t.jsx("audio",{ref:n,src:l,preload:"metadata"}),t.jsxs("div",{className:"mt-3 space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("button",{onClick:k,className:"flex h-10 w-10 items-center justify-center rounded-full bg-skin-accent text-white hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-skin-accent focus:ring-offset-2","aria-label":r?"Pause":"Play",children:r?t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"h-5 w-5",children:t.jsx("path",{d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z"})}):t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"h-5 w-5",children:t.jsx("path",{d:"M8 5v14l11-7z"})})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("input",{type:"range",min:"0",max:f||0,value:m,onChange:w,className:"w-full",style:{accentColor:"var(--color-accent)"}}),t.jsxs("div",{className:"mt-1 flex justify-between text-xs opacity-70",children:[t.jsx("span",{children:j(m)}),t.jsx("span",{children:j(f)})]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("label",{htmlFor:"playback-speed",className:"text-sm opacity-80 whitespace-nowrap",children:i==="zh-hant"?"Êí≠ÊîæÈÄüÂ∫¶":"Speed"}),t.jsxs("select",{id:"playback-speed",value:c.toString(),onChange:S,className:"rounded-md border border-skin-line bg-skin-fill px-2 py-1 text-sm focus:border-skin-accent focus:outline-none focus:ring-1 focus:ring-skin-accent",children:[t.jsx("option",{value:"0.5",children:"0.5√ó"}),t.jsx("option",{value:"0.75",children:"0.75√ó"}),t.jsx("option",{value:"1.0",children:"1.0√ó"}),t.jsx("option",{value:"1.25",children:"1.25√ó"}),t.jsx("option",{value:"1.5",children:"1.5√ó"}),t.jsx("option",{value:"1.75",children:"1.75√ó"}),t.jsx("option",{value:"2.0",children:"2.0√ó"})]})]})]})]})]})})}export{P as default};
