import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r as n}from"./index.Cd_vQiNd.js";const L="audio-playback-speed";function M({slug:p,lang:i="en"}){const s=n.useRef(null),[c,o]=n.useState(!1),[f,u]=n.useState(0),[x,d]=n.useState(0),[r,m]=n.useState(1),[v,y]=n.useState(null),l=n.useRef(!1),h=i==="zh-hant"?`/podcasts/${p}.zh-hant.mp3`:`/podcasts/${p}.mp3`;n.useEffect(()=>{(async()=>{try{const a=await fetch(h,{method:"HEAD"});y(a.ok)}catch{y(!1)}})()},[h]),n.useEffect(()=>{const e=localStorage.getItem(L);if(e){const a=parseFloat(e);!isNaN(a)&&a>=.25&&a<=2&&m(a)}},[]),n.useEffect(()=>{const e=s.current;e&&e.readyState>0&&(e.playbackRate=r)},[r]);const P=e=>{if(s.current&&l.current){const a=s.current;a.removeEventListener("timeupdate",g),a.removeEventListener("loadedmetadata",b),a.removeEventListener("durationchange",k),a.removeEventListener("canplay",S),a.removeEventListener("ended",j),a.removeEventListener("play",E),a.removeEventListener("pause",N),l.current=!1}s.current=e,e&&!l.current&&(e.addEventListener("timeupdate",g),e.addEventListener("loadedmetadata",b),e.addEventListener("durationchange",k),e.addEventListener("canplay",S),e.addEventListener("ended",j),e.addEventListener("play",E),e.addEventListener("pause",N),l.current=!0,e.readyState>0&&(!isNaN(e.duration)&&isFinite(e.duration)&&e.duration>0&&d(e.duration),e.currentTime>0&&u(e.currentTime),e.playbackRate=r))},g=()=>{s.current&&u(s.current.currentTime)},j=()=>{o(!1)},E=()=>{o(!0)},N=()=>{o(!1)},b=()=>{if(s.current){const e=s.current;!isNaN(e.duration)&&isFinite(e.duration)&&d(e.duration),e.playbackRate=r}},k=()=>{if(s.current){const e=s.current;!isNaN(e.duration)&&isFinite(e.duration)&&d(e.duration)}},S=()=>{if(s.current){const e=s.current;!isNaN(e.duration)&&isFinite(e.duration)&&d(e.duration)}},T=()=>{s.current&&(c?s.current.pause():s.current.play(),o(!c))},C=e=>{const a=parseFloat(e.target.value);u(a),s.current&&(s.current.currentTime=a)},A=e=>{const a=parseFloat(e.target.value);m(a),localStorage.setItem(L,a.toString()),s.current&&(s.current.playbackRate=a)},w=e=>{if(isNaN(e))return"0:00";const a=Math.floor(e/60),z=Math.floor(e%60);return`${a}:${z.toString().padStart(2,"0")}`};return v===null||!v?null:t.jsx("div",{className:"mb-6 rounded-lg border border-skin-line bg-skin-card p-4",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("span",{"aria-hidden":!0,className:"text-2xl",children:"üéß"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"m-0 text-base font-semibold text-skin-accent",children:i==="zh-hant"?"Èü≥Ë®äÁâàÊú¨":"Audio Version"}),t.jsx("p",{className:"mt-1 text-xs opacity-70",children:i==="zh-hant"?"Áî± Kokoro TTS ÁîüÊàê":"Generated by Kokoro TTS"}),t.jsx("audio",{ref:P,src:h,preload:"metadata"}),t.jsxs("div",{className:"mt-3 space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("button",{onClick:T,className:"flex h-10 w-10 items-center justify-center rounded-full bg-skin-accent text-white hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-skin-accent focus:ring-offset-2","aria-label":c?"Pause":"Play",children:c?t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"h-5 w-5",children:t.jsx("path",{d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z"})}):t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"h-5 w-5",children:t.jsx("path",{d:"M8 5v14l11-7z"})})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("input",{type:"range",min:"0",max:x||0,value:f,onChange:C,className:"w-full",style:{accentColor:"var(--color-accent)"}}),t.jsxs("div",{className:"mt-1 flex justify-between text-xs opacity-70",children:[t.jsx("span",{children:w(f)}),t.jsx("span",{children:w(x)})]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("label",{htmlFor:"playback-speed",className:"text-sm opacity-80 whitespace-nowrap",children:i==="zh-hant"?"Êí≠ÊîæÈÄüÂ∫¶":"Speed"}),t.jsxs("select",{id:"playback-speed",value:r.toString(),onChange:A,className:"rounded-md border border-skin-line bg-skin-fill px-2 py-1 text-sm focus:border-skin-accent focus:outline-none focus:ring-1 focus:ring-skin-accent",children:[t.jsx("option",{value:"0.5",children:"0.5√ó"}),t.jsx("option",{value:"0.75",children:"0.75√ó"}),t.jsx("option",{value:"1.0",children:"1.0√ó"}),t.jsx("option",{value:"1.25",children:"1.25√ó"}),t.jsx("option",{value:"1.5",children:"1.5√ó"}),t.jsx("option",{value:"1.75",children:"1.75√ó"}),t.jsx("option",{value:"2.0",children:"2.0√ó"})]})]})]})]})]})})}export{M as default};
