import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as n}from"./index.DiEladB3.js";const j=["#326CE5","#0F1689","#7B42BC","#E00","#0EA5E9","#F59E0B","#10B981","#EC4899"];function L(t,u,a){if(t.color)return t.color;if(u===1)return j[a%j.length]}function v({node:t,expandedIds:u,onToggle:a,onSelectNode:h,selectedNodeId:f,depth:r}){const l=t.children&&t.children.length>0,d=u.has(t.id),k=f===t.id,b=!!t.notes,x=n.useCallback(c=>{c.stopPropagation(),l&&a(t.id)},[l,a,t.id]),m=n.useCallback(c=>{c.stopPropagation(),h(t)},[h,t]),p=r===0;return e.jsxs("div",{className:`${p?"":"ml-4 sm:ml-6"}`,children:[e.jsxs("div",{className:"group flex items-center gap-1.5 py-0.5",children:[l?e.jsx("button",{onClick:x,className:"text-skin-base/60 hover:bg-skin-card hover:text-skin-accent flex h-5 w-5 flex-shrink-0 items-center justify-center rounded transition-colors","aria-label":d?"Collapse":"Expand",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:`transition-transform duration-150 ${d?"rotate-90":""}`,children:e.jsx("path",{d:"M9 18l6-6-6-6"})})}):e.jsx("span",{className:"flex h-5 w-5 flex-shrink-0 items-center justify-center",children:e.jsx("span",{className:"bg-skin-base/30 h-1.5 w-1.5 rounded-full"})}),e.jsxs("span",{onClick:x,className:`inline-flex items-center gap-1.5 rounded px-1.5 py-0.5 text-sm transition-colors select-none ${l?"cursor-pointer":"cursor-default"} ${p?"text-skin-base text-base font-bold":k?"bg-skin-accent/10 text-skin-accent font-medium":"text-skin-base hover:text-skin-accent font-medium"}`,style:t.color&&r<=1?{color:t.color}:void 0,children:[t.label,l&&e.jsxs("span",{className:"text-skin-base/40 text-xs",children:["(",t.children.length,")"]})]}),b&&e.jsx("button",{onClick:m,className:`flex h-5 w-5 flex-shrink-0 items-center justify-center rounded-full transition-colors ${k?"bg-skin-accent text-skin-inverted":"bg-skin-accent/20 text-skin-accent opacity-0 group-hover:opacity-100"}`,"aria-label":"View notes",title:"View notes",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"1"}),e.jsx("circle",{cx:"12",cy:"5",r:"1"}),e.jsx("circle",{cx:"12",cy:"19",r:"1"})]})})]}),l&&d&&e.jsx("div",{className:"border-skin-line/50 ml-2.5 border-l",style:t.color?{borderColor:`${t.color}30`}:void 0,children:t.children.map((c,g)=>e.jsx(v,{node:{...c,color:c.color??L(c,r+1,g)},expandedIds:u,onToggle:a,onSelectNode:h,selectedNodeId:f,depth:r+1},c.id))})]})}function B({node:t,onClose:u}){return e.jsxs("div",{className:"border-skin-accent/30 bg-skin-card rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-skin-base font-semibold",style:t.color?{color:t.color}:void 0,children:t.label})}),e.jsx("button",{onClick:u,className:"text-skin-base/60 hover:bg-skin-card-muted hover:text-skin-accent flex h-6 w-6 flex-shrink-0 items-center justify-center rounded transition-colors","aria-label":"Close notes",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),e.jsx("p",{className:"text-skin-base/80 mt-2 text-sm leading-relaxed",children:t.notes})]})}function A({mindmap:t}){const[u,a]=n.useState(()=>{const s=new Set;return s.add(t.root.id),t.root.children?.forEach(i=>s.add(i.id)),s}),[h,f]=n.useState(null),[r,l]=n.useState({x:0,y:0}),[d,k]=n.useState(!1),b=n.useRef({x:0,y:0}),x=n.useRef({x:0,y:0}),m=n.useRef(null),p=n.useCallback(s=>{a(i=>{const o=new Set(i);return o.has(s)?o.delete(s):o.add(s),o})},[]),c=n.useCallback(()=>{const s=new Set,i=o=>{s.add(o.id),o.children?.forEach(i)};i(t.root),a(s)},[t]),g=n.useCallback(()=>{a(new Set([t.root.id]))},[t]),w=n.useCallback(()=>{l({x:0,y:0})},[]),C=n.useCallback(s=>{s.button===0&&(k(!0),b.current={x:s.clientX,y:s.clientY},x.current={...r})},[r]),y=n.useCallback(s=>{if(!d)return;const i=s.clientX-b.current.x,o=s.clientY-b.current.y;l({x:x.current.x+i,y:x.current.y+o})},[d]),N=n.useCallback(()=>{k(!1)},[]),E=n.useCallback(s=>{s.touches.length===1&&(k(!0),b.current={x:s.touches[0].clientX,y:s.touches[0].clientY},x.current={...r})},[r]),M=n.useCallback(s=>{if(!d||s.touches.length!==1)return;const i=s.touches[0].clientX-b.current.x,o=s.touches[0].clientY-b.current.y;l({x:x.current.x+i,y:x.current.y+o})},[d]),S=n.useCallback(()=>{k(!1)},[]);return n.useEffect(()=>{const s=()=>k(!1);return window.addEventListener("mouseup",s),window.addEventListener("touchend",s),()=>{window.removeEventListener("mouseup",s),window.removeEventListener("touchend",s)}},[]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-skin-base text-xl font-bold",children:t.title}),e.jsx("p",{className:"text-skin-base/70 mt-1 text-sm",children:t.description})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("button",{onClick:c,className:"border-skin-line text-skin-base hover:border-skin-accent hover:text-skin-accent rounded border px-2.5 py-1 text-xs transition-colors",children:"Expand All"}),e.jsx("button",{onClick:g,className:"border-skin-line text-skin-base hover:border-skin-accent hover:text-skin-accent rounded border px-2.5 py-1 text-xs transition-colors",children:"Collapse All"}),e.jsx("button",{onClick:w,className:"border-skin-line text-skin-base hover:border-skin-accent hover:text-skin-accent rounded border px-2.5 py-1 text-xs transition-colors",children:"Reset View"}),e.jsxs("span",{className:"text-skin-base/50 ml-auto text-xs",children:["Drag to pan · Click nodes to expand · Click"," ",e.jsx("span",{className:"bg-skin-accent/40 inline-block h-3 w-3 rounded-full align-middle"})," ","for notes"]})]}),e.jsx("div",{ref:m,className:`border-skin-line bg-skin-fill relative overflow-hidden rounded-lg border ${d?"cursor-grabbing":"cursor-grab"}`,style:{minHeight:"420px"},onMouseDown:C,onMouseMove:y,onMouseUp:N,onTouchStart:E,onTouchMove:M,onTouchEnd:S,children:e.jsx("div",{className:"inline-block min-w-full p-6 transition-transform duration-75",style:{transform:`translate(${r.x}px, ${r.y}px)`},children:e.jsx(v,{node:t.root,expandedIds:u,onToggle:p,onSelectNode:f,selectedNodeId:h?.id??null,depth:0})})}),h&&h.notes&&e.jsx(B,{node:h,onClose:()=>f(null)})]})}export{A as MindMapViewer};
